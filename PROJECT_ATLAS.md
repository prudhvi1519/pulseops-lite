# PulseOps Lite â€” Project Atlas

> **Forensic Audit & Project Master Map**
> Generated by Antigravity on 2026-01-11

## 1. Executive Overview
PulseOps Lite is a multi-tenant, serverless observability platform built on the **Next.js App Router** (React 19) and **PostgreSQL** (via Vercel Postgres). It allows developers to ingest logs via API keys, monitor them with real-time alert rules, and receive incident notifications via external channels (Slack/Discord).

It is designed for the **Vercel Free Tier**, utilizing:
- **Stateless Auth**: HttpOnly cookies with SQL-backed session validation (`sessions` table).
- **Serverless Ingestion**: High-throughput log ingestion via Vercel Functions.
- **Cron-based Async Processing**: Alert evaluation and notification delivery handled by GitHub Actions (cron triggers) calling internal API endpoints protected by shared secrets.

## 2. Architecture & Data Flow

```ascii
[USER / BROWSER]          [EXTERNAL SERVICE]         [GITHUB CRON]
       |                          |                        |
       | (HTTPS/Cookie)           | (HTTPS/API Key)        | (HTTPS/Cron Secret)
       v                          v                        v
+--------------------------------------------------------------------------+
|                        NEXT.JS APP ROUTER                                |
+----------------------+-----------------------+---------------------------+
|   UI LAYER           |    INGESTION API      |    BACKGROUND API         |
| /dashboard/*         | /api/v1/logs/ingest   | /api/v1/rules/evaluate    |
| /login, /signup      |                       | /api/v1/notifs/process    |
+----------+-----------+-----------+-----------+-------------+-------------+
           |                       |                         |
           v                       v                         v
+--------------------------------------------------------------------------+
|                        POSTGRES DATABASE                                 |
| 1. users, orgs, sessions (Identity)                                      |
| 2. logs, alert_rules (Observability Data)                                |
| 3. incidents, alert_firings (State)                                      |
| 4. notification_jobs (Async Queue)                                       |
+--------------------------------------------------------------------------+
```

## 3. Key Workflows (Forensic Map)

### A. Authentication & Tenancy
- **Boundary**: strict multi-tenancy enforced at the SQL level (all queries require `org_id`).
- **Mechanism**: Custom session implementation (`lib/auth/session.ts`).
- **Flow**: Login -> `POST /api/auth/login` -> Verify `bcrypt` hash -> Create Session -> Set HttpOnly Cookie.

### B. Field Data Ingestion
- **Endpoint**: `POST /api/v1/logs/ingest`
- **Auth**: API Key (`X-API-Key` header). Keys are hashed (`sha256`) and validated against `api_keys` table.
- **Validation**: Zod schema check on payload.
- **Storage**: Direct write to `logs` table.

### C. Alert Evaluation Loop
- **Trigger**: GitHub Action (`cron-rules-evaluate.yml`) adds entropy every 5 mins.
- **Action**: Calls `POST /api/v1/rules/evaluate` with `CRON_SECRET`.
- **Logic**: Queries `logs` for matches against active `alert_rules`.
- **Result**: Creates `alert_firings` and aggregates them into `incidents`.

### D. Notification Dispatch
- **Trigger**: GitHub Action (`cron-notifications-process.yml`) runs every 5 mins.
- **Action**: Calls `POST /api/v1/notifications/process`.
- **Logic**: SELECTs `pending` jobs from `notification_jobs` -> Calls external webhook (Slack/Discord) -> Updates status to `completed` or `failed`.

## 4. Documentation Inventory

| Document | Purpose |
|----------|---------|
| **[CODEMAP.md](./CODEMAP.md)** | File-by-file forensic logic map. Explains *what* every file does. |
| **[API_SPEC.md](./API_SPEC.md)** | Exact API routes, methods, schemas, and auth requirements. |
| **[UI_SPEC.md](./UI_SPEC.md)** | Inventory of pages, components, and UX inventory. |
| **[DB_SCHEMA.md](./DB_SCHEMA.md)** | Database tables, indexes, and relationship diagram. |
| **[AUTOMATION_AND_DEPLOY.md](./AUTOMATION_AND_DEPLOY.md)** | CI/CD pipelines, Cron setups, and Deployment guide. |
| **[SECURITY_REVIEW.md](./SECURITY_REVIEW.md)** | Vulnerability assessment, RBAC checks, and hardening steps. |
| **[STATUS_AND_NEXT_STEPS.md](./STATUS_AND_NEXT_STEPS.md)** | Current project status, completion percentages, and todo list. |

## 5. Navigation Hotspots
- **Core Logic**: `app/api/v1` (Public API) and `app/api/internal` (Cron/System API).
- **Shared Utils**: `lib/db/index.ts` (Data Access), `lib/auth/session.ts` (Security).
- **UI Pages**: `app/dashboard` (Authenticated App), `app/(auth)` (Login/Signup).
- **Tests**: `tests/api` (End-to-end API tests).

## 6. How to Run
1. **Dev**: `pnpm dev`
2. **Test**: `pnpm test` (Runs Vitest)
3. **Deploy**: Push to main (Vercel Auto-Deploy) or `vercel deploy --prod`.
